<!DOCTYPE html>
<html>
<head>
    <title>Chat - D-cont</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#05060A">
    <link rel="stylesheet" href="{{ url_for('static', filename='app.css', v=asset_version) }}">
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json', v=asset_version) }}">
    <link rel="icon" type="image/png" sizes="192x192" href="{{ url_for('static', filename='icons/icon-192.png', v=asset_version) }}">
    <link rel="icon" type="image/png" sizes="512x512" href="{{ url_for('static', filename='icons/icon-512.png', v=asset_version) }}">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='icons/apple-touch-icon.png', v=asset_version) }}">
</head>
<body class="app-body hasTabs">
    {% set nav_user_pill = 'Bot' %}
    {% include '_tab_nav.html' %}

    <div class="container" style="max-width: 760px;">
        <div class="card card-pro card-lg" style="padding: 18px;">
        <div class="row" style="justify-content:space-between; align-items:center; gap:10px;">
            <h2 class="pageTitle" style="margin:0;">D-CONT Bot</h2>
            <a href="/home" class="btn btn-secondary btn-sm" style="width:auto;">Back</a>
        </div>

        <div class="notice" style="margin-top:12px; padding:12px;">
            <strong>Trust:</strong> D-CONT never holds money. Payments happen directly between members.
        </div>

        <div class="section" style="margin-top:12px; height: 360px; overflow:auto;">
            {% for m in history %}
                {% if m.from == 'user' %}
                    <div style="display:flex; justify-content:flex-end; margin:8px 0;">
                        <div style="max-width: 78%; background: rgba(124, 92, 255, 0.28); color: var(--text); padding:10px 12px; border-radius:10px; border: 1px solid var(--border);">{{ m.text }}</div>
                    </div>
                {% else %}
                    <div style="display:flex; justify-content:flex-start; margin:8px 0;">
                        <div style="max-width: 78%; background: rgba(16, 20, 37, 0.55); color: var(--text); padding:10px 12px; border-radius:10px; border: 1px solid var(--border);">{{ m.text }}</div>
                    </div>
                {% endif %}
            {% endfor %}
        </div>

        {% if intent_link and intent_link_label %}
            <div style="margin-top:10px;">
                <a href="{{ intent_link }}" class="btn btn-sm" style="display:inline-block; width:auto;">{{ intent_link_label }}</a>
            </div>
        {% endif %}

        {% if whatsapp_url %}
            <div class="section" style="margin-top:12px;">
                <a href="{{ whatsapp_url }}" target="_blank" rel="noopener" class="btn" style="display:inline-block; width:auto;">Chat on WhatsApp</a>
                <div class="muted" style="margin-top:10px; font-size:0.95em; line-height:1.4;">
                    We won’t ask for OTP, UPI PIN, or bank details in chat.
                </div>
            </div>
        {% endif %}

        <div style="margin-top:12px;">
            <div style="display:flex; flex-wrap:wrap; gap:8px;">
                {% for q in quick_replies %}
                    <form method="post" style="margin:0;">
                        <input type="hidden" name="message" value="{{ q }}">
                        <button type="submit" class="btn btn-sm btn-secondary" style="width:auto; border-radius:999px;">{{ q }}</button>
                    </form>
                {% endfor %}
            </div>
        </div>

        <form method="post" style="margin-top:12px; display:flex; gap:8px; align-items:center;">
            <input type="text" name="message" placeholder="Type your question…" class="input" style="flex:1; margin:0;">
            <button type="submit" class="btn btn-sm" style="width:auto;">Send</button>
        </form>

        </div>
    </div>
</body>
</html>
