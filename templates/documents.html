<!DOCTYPE html>
<html>
<head>
    <title>Documents - D-cont</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#05060A">
    <link rel="stylesheet" href="{{ url_for('static', filename='app.css', v=asset_version) }}">
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json', v=asset_version) }}">
    <link rel="icon" type="image/png" sizes="192x192" href="{{ url_for('static', filename='icons/icon-192.png', v=asset_version) }}">
    <link rel="icon" type="image/png" sizes="512x512" href="{{ url_for('static', filename='icons/icon-512.png', v=asset_version) }}">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='icons/apple-touch-icon.png', v=asset_version) }}">
</head>
<body class="app-body">
    <div class="topbar">
        <div class="topbarInner">
            <div class="brand">
                <div class="brandWrap">
                    <img src="/static/logo.svg" onerror="this.onerror=null;this.src='/static/logo.png';" alt="D-CONT" />
                </div>
                <span class="brandText">D-CONT</span>
            </div>
            <div class="pill">Documents</div>
        </div>
    </div>

    <div class="container container-wide">
        <div class="card card-pro card-lg">
        <div class="row" style="justify-content: space-between; align-items:center; gap: 12px;">
            <h2 class="pageTitle">Documents</h2>
            <div class="btn-row" style="margin-top:0; width:auto;">
                <a href="{% if session.get('role') == 'admin' %}/dashboard{% else %}/home{% endif %}" class="btn btn-secondary btn-sm" style="width:auto;">Back</a>
                <a href="/logout" class="btn btn-sm" style="width:auto;">Logout</a>
            </div>
        </div>

                {% with messages = get_flashed_messages() %}
                    {% if messages %}
                        <div class="notice" style="margin-top:12px; padding:10px 12px;">
                            {{ messages[0] }}
                        </div>
                    {% endif %}
                {% endwith %}

        <div class="section" style="margin-top:14px;">
            <div class="sectionTitle" style="margin-top:0;">Upload document</div>
            <form method="post" action="/api/upload-document" enctype="multipart/form-data" style="display:grid; grid-template-columns: 220px 1fr 220px; gap:10px; align-items:center; margin:0;">
                <select name="doc_type" required class="input" style="margin:0;">
                    <option value="">Select type</option>
                    <option value="pan">PAN Card</option>
                    <option value="aadhaar">Aadhaar Card</option>
                    <option value="passport">Passport</option>
                    <option value="payment_screenshot">Payment Screenshot</option>
                    <option value="other">Other</option>
                </select>
                <input type="text" name="notes" placeholder="Notes (optional)" class="input" style="margin:0;">
                <input type="file" name="file" required accept="image/*,application/pdf" class="input" style="margin:0; padding:10px;">
                <button type="submit" class="btn" style="grid-column: 1 / -1;">Upload</button>
            </form>
            <div class="muted" style="margin-top:10px; font-size:0.95em;">Allowed: PNG/JPG/JPEG/WEBP/GIF/PDF</div>
        </div>

        <h3 class="sectionTitle" style="margin-top:22px;">All uploaded documents</h3>
        {% if docs and docs|length > 0 %}
            <table class="table">
                <thead>
                    <tr>
                        <th>Type</th>
                        <th>Uploaded by</th>
                        <th>File</th>
                        <th>Notes</th>
                        <th>Time</th>
                    </tr>
                </thead>
                <tbody>
                {% for d in docs %}
                    <tr>
                        <td>{{ d.doc_type }}</td>
                        <td>{{ d.uploader_username }}</td>
                        <td>
                            <a href="/static/{{ d.stored_path }}" target="_blank" rel="noopener">View / Download</a>
                            {% if d.original_filename %}
                                <div class="muted" style="font-size:0.9em; margin-top:4px;">{{ d.original_filename }}</div>
                            {% endif %}
                        </td>
                        <td class="muted">{{ d.notes }}</td>
                        <td class="muted">{{ d.created_at }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p class="muted">No documents uploaded yet.</p>
        {% endif %}

        </div>
    </div>
</body>
</html>
