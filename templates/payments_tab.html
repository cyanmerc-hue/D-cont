<!DOCTYPE html>
<html>
<head>
  <title>{{ t('payments_title') }} - D-cont</title>
  <meta name="theme-color" content="#05060A">
  <link rel="stylesheet" href="{{ url_for('static', filename='app.css', v=asset_version) }}">
  <link rel="manifest" href="{{ url_for('static', filename='manifest.json', v=asset_version) }}">
  <link rel="icon" type="image/png" sizes="192x192" href="{{ url_for('static', filename='icons/icon-192.png', v=asset_version) }}">
  <link rel="icon" type="image/png" sizes="512x512" href="{{ url_for('static', filename='icons/icon-512.png', v=asset_version) }}">
  <link rel="apple-touch-icon" href="{{ url_for('static', filename='icons/apple-touch-icon.png', v=asset_version) }}">
</head>
<body class="app-body">
  {% include '_tab_nav.html' %}

  <div class="container">
    <div class="card">
    <h2 style="margin:0;">{{ t('payments_title') }}</h2>

    <div class="notice" style="margin-top:14px;">
      <div><strong>{{ t('label_your_upi') }}</strong> {% if upi_id %}{{ upi_id }}{% else %}<span class="muted">{{ t('not_set') }}</span>{% endif %}</div>
      {% if not upi_id %}
        <a href="/profile" class="btn" style="display:inline-block; margin-top:10px; width:auto;">{{ t('btn_add_upi_in_profile') }}</a>
      {% endif %}
    </div>

    <div class="card-pro" style="margin-top:14px; padding:14px;">
      <div class="sectionTitle" style="margin-top:0;">{{ t('app_fee_card_title') }}</div>
      <div class="muted" style="margin-top:6px; line-height:1.45;">{{ t('referral_credit_disclaimer') }}</div>

      {% set credit_to_show = (app_fee_credit_applied_actual if app_fee_paid_this_month else app_fee_credit_preview) %}
      {% set net_to_show = (app_fee_net_amount_actual if app_fee_paid_this_month else (app_fee_amount - app_fee_credit_preview)) %}

      <div class="notice" style="margin-top:12px;">
        <div style="display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap;">
          <div><strong>{{ t('app_fee_monthly_fee') }}</strong> ₹{{ app_fee_amount }}</div>
          <div><strong>{{ t('app_fee_credit_applied') }}</strong> -₹{{ credit_to_show or 0 }}</div>
          <div><strong>{{ t('app_fee_you_pay') }}</strong> ₹{{ net_to_show if net_to_show > 0 else 0 }}</div>
        </div>
        <div class="muted" style="margin-top:8px;">{{ t('referral_app_fee_credit_balance') }} ₹{{ app_fee_credit_balance or 0 }}</div>
        {% if app_fee_paid_this_month %}
          <div style="margin-top:8px; font-weight:800;">{{ t('app_fee_paid_this_month') }}</div>
        {% endif %}
      </div>
    </div>

    <h3 class="sectionTitle" style="margin-top:18px;">{{ t('who_to_pay') }}</h3>
    {% if pay_to and pay_to|length > 0 %}
      <ul style="list-style:none; padding:0; margin:0;">
        {% for item in pay_to %}
          <li class="card-pro" style="margin-bottom:12px; padding:14px;">
            <div style="font-weight:bold; color:#2D9CDB;">{{ item.group.name }}</div>
            <div><strong>₹{{ item.amount }}</strong> {{ t('label_per_month') }}</div>
            {% if item.due_date %}
              <div class="notice" style="margin-top:10px;">
                <strong>{{ t('label_due_today') }}</strong> {{ item.due_date }} • {{ t('label_pay_before') }} <strong>{{ item.pay_cutoff_time }}</strong>
              </div>
            {% endif %}
            <div class="muted" style="margin-top:6px;"><strong>{{ t('label_receiver') }}</strong> {{ item.receiver_name }}</div>
            <div class="muted" style="margin-top:4px;"><strong>{{ t('label_upi_short') }}</strong> {% if item.receiver_upi %}{{ item.receiver_upi }}{% else %}<span class="muted">{{ t('not_set') }}</span>{% endif %}</div>

            <div class="muted" style="margin-top:10px; line-height:1.45;">
              {{ t('benefit_one_liner') }}
            </div>

            {% if item.pay_url %}
              <div class="muted" style="margin-top:6px;">{{ t('payments_pay_directly') }}</div>
              <a href="{{ item.pay_url }}" style="display:inline-block; margin-top:10px; background:#2D9CDB; color:#fff; padding:10px 14px; border-radius:8px; text-decoration:none;">{{ t('pay_via_upi') }}</a>
            {% else %}
              <div class="muted" style="margin-top:10px;">{{ t('payment_link_unavailable') }}</div>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <div class="muted">{{ t('payments_join_to_see') }}</div>
      <a href="/groups" class="btn" style="display:inline-block; margin-top:10px; width:auto;">{{ t('go_to_groups') }}</a>
    {% endif %}
    </div>
  </div>

</body>
</html>
